---
title: "ppm-data-generation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ppm-data-generation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(qrbp)
```

For a laugh, let's generate some quasirandom background points and plot them against the presence points. Here we are using the `quasirandom_covariates` method which tries to select quasirandom points across geographic and environmental space. The other working methods are `quasirandom` which just creates quasirandom points spatially, or `grid` which creates a regular grid at a set resolution - this is every similar to the grid design proposed by Warton & Shepard 2010.

```{r,warning=FALSE,error=FALSE,message=FALSE}
library(mgcv)
library(raster)
path <- system.file("extdata", package = "qrbp")
lst <- list.files(path=path,pattern='*.tif',full.names = TRUE)
preds <- raster::stack(lst)

presences <- snails
window <- preds[[1]]
covariates <- NULL#preds
method <- 'grid'
interpolation <- 'bilinear'
npoints <- 1000
resolution <- 0.0083
covariates <- preds
control <- ppmData.control()
coord <- c("X","Y")

snail1 <- subset(snails,SpeciesID=='Austrorhytida lamproides')

bkgrid<- ppmData(npoints = npoints,
                 resolution = resolution,
                 presences = snail1,
                 window = window,
                 covariates = covariates,
                 method = method,
                 interpolation = interpolation,
                 control=ppmData.control())

dat <- bkgrid$modelmatrix
dat <- na.omit(dat)

fm <- gam(pres/wts ~ s(max_temp_hottest_month)+ s(min_temp_coldest_month)+s(precip_of_driest_month),
              weights = wts,
              data = dat,
              family = poisson())

p <- predict(object=preds,
             model=fm,
             type = 'response',
             const=data.frame(weights = 1))
# 
p_cell <- p*(area(preds)/10000)#prod(bkgrid$parameters$newresolution)
# resolution of raster changes with bkpts_quasi - need to remember that. 
cellStats(p_cell,sum)

```

Now let's plot these models.
```{r,fig.width=8,fig.height=6}
jet.colors <- colorRampPalette(rev(RColorBrewer::brewer.pal(11 , "Spectral")[-11]))
plot(p_cell,col=jet.colors(100))
points(snail1[,1:2],cex=.5,pch=16)
```
